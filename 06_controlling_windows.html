<section>
<h2>Command Contexts</h2>

<section>
  <h3>Introduction</h3>

  <p>Many WebDriver commands happen in the context of either
    the <a>current browsing context</a> or <a>current top-level browsing
      context</a>. The <a>current top-level browsing context</a> is
    represened in the protocol by its associated <a>window
      handle</a>. A top-level browsing context is selected using
    the <a>Switch To Window</a> command. Once this is done, a
    specific browsing context can be selected using the <a>Switch to
      Frame</a> command.

  <p class=note>The use of the term "window" to refer to a top-level
    browsing context is legacy and doesn't correspond with either the
    operating system notaion of a "window" or the DOM Window object.</p>

  <p class=note>In accordance with
    the <a href="http://www.w3.org/TR/html5/editing.html#focus">focus</a>
    section of the [[!html51] spec, commands are unaffected by whether
    the operating-system window has focus or not.</p>

  </section>
 <section>
   <h3>Get Window Handle</h3>

   <table class="simple jsoncommand">
     <tr>
       <th>HTTP Method</th>
       <th>Path Template</th>
       <th>Notes</th>
     </tr>
     <tr>
       <td>GET</td>
       <td>/session/{sessionId}/window_handle</td>
       <td></td>
     </tr>
   </table>

   <p>The <a>Get Window Handle</a> command returns the <a>window
     handle</a> for the <a>current top-level browsing context</a>. It
     can be used as an argument to <a>Switch to Window</a>.

   <p>The <a>remote end steps</a> for the <dfn>Get Window Handle</dfn> command are:

     <ol>
       <li><p>If the <a>current top-level browsing context</a>
           is <a>no longer open</a>, return an error with code <a>no
           such window</a>.</li>

       <li><p>Let <var>data</var> be a new JSON Object.</li>

       <li><p>Set the property "<code>value</code>" on <var>data</var>
           to the value of the <a>window handle</a> associated with
           the <a>current top-level browsing context</a>.

           <li>Return <a>success</a> with data <var>data</var>.
     </ol>
   </section>

   <section>
     <h3>Get Window Handles</h3>

     <p>
       <table class="simple jsoncommand">
         <tr>
           <th>HTTP Method</th>
           <th>Path Template</th>
           <th>Notes</th>
         </tr>
         <tr>
           <td>GET</td>
           <td id='get-window_handles'>/session/{sessionId}/window_handles</td>
           <td></td>
         </tr>
       </table>

     <p>The <a>Get Window Handle</a> command returns a list
         of <a>window handle</a>s for every open <a>top-level browsing
         context</a>. The order in which the window handles are
         returned is arbitary.

     <p>The <a>remote end steps</a> for the <dfn>Get Window
     Handles</dfn> command are:</p>

     <ol>
       <li><p>Let <var>data</var> be a new JSON Object.</li>

       <li><p>Let <var>value</var> be a JSON list object</p></li>

       <li><p>For each <a>top-level browsing context</a> in the
           remote end, push the associated <a>window handle</a>
           to <var>value</var>.</li>

       <li><p>Set the property "<code>value</code>" on <var>data</var>
           to <var>value</var>.</li>

       <li>Return <a>success</a> with data <var>data</var>.
     </ol>

     <p class="note">In order to determine whether or not a particular interaction with the browser opens a new window one can obtain the set of <a href='#window-handle'>window handle</a> before the interaction is performed and compare it with the set after the action is performed.</p>
   </section>

   <section>
     <h3>Switch to Window</h3>
        <p>
          <table class="simple jsoncommand">
            <tr>
              <th>HTTP Method</th>
              <th>Path Template</th>
              <th>Notes</th>
            </tr>
            <tr>
              <td>POST</td>
              <td id='post-window'>/session/{sessionId}/window</td>
              <td></td>
            </tr>
          </table>
        <p>The Switch to Window command is used to select
          the <a>active top level browsing context</a> for the current
          session; i.e. the one that will be used for processing
          commands.

        <p>The <a>remote end steps</a> for the <dfn>Switch to
        Window</dfn> command are:</p>

        <ol>
          <li><p>Let <var>handle</var> be the result of <a>getting a
          property</a> named "handle" from the <var>parameters</var>
          argument.</li>

          <li><p>If <var>handle</var> is equal to the
          associated <a>window handle</a> for some <a>top-level
          browsing context</a> in the current session, set the
          session's <a>current browsing context</a> to that
          browsing context and return <a>success</a> with data
          null.</li>

          <li><p>Otherwise, return <a>error</a> with code <a>no such
          window</a>.</p></li>
        </ol>
    </section>

   <section>
     <h3>Close Window</h3>
     <p>
       <table class="simple jsoncommand">
         <tr>
           <th>HTTP Method</th>
           <th>Path Template</th>
           <th>Notes</th>
         </tr>
         <tr>
           <td>DELETE</td>
           <td id='delete-window_handle'>/session/{sessionId}/window_handle</td>
           <td></td>
         </tr>
       </table>

     <p>The <a>remote end steps</a> for the <dfn>Close Window</dfn> command are:</p>
     <ol>
       <li><p>If the <a>current top-level browsing context</a> is <a>no longer open</a>,
           return an error with code <a>no such window</a>.</li>

       <!-- this can prompt to unload, in which case the operation really failed -->
       <li><p><a href="https://html.spec.whatwg.org/#closing-browsing-contexts">Close</a> the <a>current top-level browsing context</a></p></li>

       <li><p>If there are no more open <a>top-level browsing contexts</a>, then <a>close the session</a>.</p>

       <li>Return the result of running the <a>remote end steps</a> for the <a>Get Window Handles</a> command.
     </ol>
   </section>

   <section>
     <h3>Switch to Frame</h3>
     <table class="simple jsoncommand">
       <tr>
         <th>HTTP Method</th>
         <th>Path Template</th>
         <th>Notes</th>
       </tr>
       <tr>
         <td>POST</td>
         <td id='post-frame'>/session/{sessionId}/frame</td>
         <td></td>
       </tr>
     </table>
     <p>The <a>Switch to Frame</a> command is used to select a child
     browsing context of the <a>current browsing context</a> to use as
     the <a>current browsing context</a> for subsequent commands.</p>
     <p>The <a>remote end steps</a> for the <dfn>Switch to Frame</dfn>
     command are:</p>
     <ol>

       <li><p>If the <a>current browsing context</a> is <a>no longer open</a>,
           return an error with code <a>no such window</a>.</li>

       <li><p>Let <var>id</var> be the result of <a>getting a property</a> named "id"
           from the <var>parameters</var> argument.</li>

       <li>
         <p>If <var>id</var> is null:
           <ol><li><p>Set the <a>current browsing context</a> to
                 the <a>current top-level browsing context</a>.</li>
           </ol>
         <p>Otherwise if <var>id</var> is a <code>Number</code> object:</p>
         <ol>
           <li><p>If <var>id</var> is less than 0 or greater than
           2<sup>16</sup> - 1, return <a>error</a> with status <a>no
           such frame</a>.</li>
           <li><p>Let <var>window</var> be the
               <a href="https://html.spec.whatwg.org/#concept-document-window">associated
                 window</a> of the <a>current browsing
                 context</a>'s <a href="https://html.spec.whatwg.org/#active-document">active
                 document.</a></li>
           <li><p>If <var>id</var> is not
               a <a href="http://heycam.github.io/webidl/#dfn-supported-property-indices">supported
                 property index</a> of <var>window</var>,
               return <a>error</a> with status <a>no such frame</a></li>
           <li><p>Let <var>child window</var> be the <code>WindowProxy</code> object
               obtained
               by <a href="https://html.spec.whatwg.org/#dom-window-item">determining
                 the value of an indexed property</a> of <var>window</var>
               with index <var>id</var>.</li>
           <li><p>Set the <a>current browsing context</a> to <var>new
           window</var>'s browsing context.</li>
         </ol>
         <p>Otherwise, if <var>id</var> <a>represents a WebElement</a>:
           <ol>
             <!-- note that representing a web element will have to do --
               -- same document checks, or something -->
             <li><p>Let <var>element</var> be the element <a>represented
                   by</a> <var>id</var>.</li>
             <li><p>If <var>element</var> is not a <code>frame</code>
             or <code>iframe</code> element, return <a>error</a> with
             status <a>no such frame</a>.</li>
             <li><p>Set the <a>current browsing context</a> to element's
             <a href="https://html.spec.whatwg.org/#nested-browsing-context">nested
             browsing context</a>.</li>
           </ol>
           <p>Otherwise:
             <ol>
               <li><p>Return <a>error</a> with status <a>no such
               frame</a>.</li>
             </ol>
       </li>
       <li><p>Return <a>success</a> with data null</li>
     </ol>
     <p class=note>WebDriver is not bound by the same origin policy,
     so it is always possible to switch into child browsing contexts,
     even if they are different origin to the current browsing context.</p>
   </section>
   <section>
     <h3>Switch to Parent Frame</h3>

     <table class="simple jsoncommand">
       <tr>
         <th>HTTP Method</th>
         <th>Path Template</th>
         <th>Notes</th>
       </tr>
       <tr>
         <td>POST</td>
         <td id='post-frame-parent'>/session/{sessionId}/frame/parent</td>
         <td></td>
       </tr>
     </table>
     <p>The <a>Switch to Parent Frame</a> command sets the <a>current
     browsing context</a> for future commands to the parent of
     the <a>current browsing context</a>.</p>
     <p>The <a>remote end steps</a> for <dfn>Switch to Parent
     Frame</dfn> are:</p>
     <ol>
       <li><p>If the <a>current browsing context</a> is <a>no longer open</a>,
           return an error with code <a>no such window</a>.</li>
       <li><p>If the <a>current browsing context</a> is not equal to
       the <a>current top-level browsing context</a>, set
       the <a>current browsing context</a> to
       the <a href="https://html.spec.whatwg.org/#parent-browsing-context">parent
       browsing context</a> of the <a>current browsing
       context</a>.</li>
       <li><p>Return <a>success</a> with data null</li>
     </ol>
   </section>
</section>

